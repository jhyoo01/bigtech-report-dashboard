name: Update BigTech News Data

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ(KST)ì— ì‹¤í–‰ (UTC 0ì‹œ)
    - cron: '0 0 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # í•„ìš”í•œ íŒ¨í‚¤ì§€ê°€ ìˆë‹¤ë©´ ì—¬ê¸°ì— ì¶”ê°€
        # pip install requests beautifulsoup4
    
    - name: Run crawler
      run: |
        python scripts/run_bigtech_crawler.py
        
    - name: Copy latest data
      run: |
        # ê°€ì¥ ìµœê·¼ ìƒì„±ëœ JSON íŒŒì¼ì„ ì°¾ì•„ì„œ latestë¡œ ë³µì‚¬
        LATEST_FILE=$(ls -t bigtech_data_*.json | head -1)
        if [ -f "$LATEST_FILE" ]; then
          cp "$LATEST_FILE" docs/data/bigtech_data_latest.json
          echo "Updated data file: $LATEST_FILE"
        fi
    
    - name: Commit and push changes
      run: |
        git config --local user.email "github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        git add docs/data/bigtech_data_latest.json
        git add bigtech_data_*.json bigtech_report_*.md bigtech_data_*.csv || true
        
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "ğŸ¤– Auto-update: BigTech news data $(date +'%Y-%m-%d %H:%M')"
          git push
        fi
