

name: Daily BigTech News Update

on:
  schedule:
    - cron: '0 21 * * *'  # ë§¤ì¼ ì˜¤ì „ 6ì‹œ
  workflow_dispatch:      # ìˆ˜ë™ ì‹¤í–‰
  push:                   # ì´ê±° ì¶”ê°€! í‘¸ì‹œí•  ë•Œë§ˆë‹¤ ì‹¤í–‰
    branches:
      - main
    paths:
      - '.github/workflows/update-news.yml'  # ì´ íŒŒì¼ ë³€ê²½ ì‹œë§Œ

permissions:
  contents: write
  pages: write
  id-token: write

jobs:
  update-news:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # ì´ ì¤„ ì¶”ê°€!
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
      
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      
      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4 lxml --break-system-packages
      
      - name: Run BigTech News Crawler
        run: |
          python scripts/update_news.py

- name: Commit and push if changes
  run: |
    git config --local user.email "github-actions[bot]@users.noreply.github.com"
    git config --local user.name "github-actions[bot]"
    
    # ë³€ê²½ì‚¬í•­ í™•ì¸ ë° ì»¤ë°‹
    git add bigtech_data_latest.json
    
    if ! git diff --quiet --cached; then
      # ìµœì‹  ìƒíƒœë¡œ ì—…ë°ì´íŠ¸
      git fetch origin
      git rebase origin/main
      
      git commit -m "ğŸ¤– Auto-update: BigTech News $(date +'%Y-%m-%d %H:%M')"
      git push origin main
    else
      echo "No changes to commit"
    fi
